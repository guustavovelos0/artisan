# Ralph Progress Log
Started: Sex 16 Jan 2026 00:29:35 -03

## Codebase Patterns
- Prisma 7 requires DATABASE_URL in prisma.config.ts, NOT in schema.prisma
- Use `npm run db:migrate -w @artisan/api` to run migrations (requires Docker PostgreSQL running)
- Generated Prisma client goes to node_modules/@prisma/client
- API runs on port 3001, Web will run on port 5173
- Pages go in apps/web/src/pages/ directory
- Use react-hook-form + zod for form validation with Shadcn form components
- API URL is http://localhost:3001/api
- Token and user stored in localStorage after auth
- Use ApiError class for typed error handling in catch blocks
- AuthContext provides isLoading state for showing loading spinners during auth check
- Layout component wraps protected routes for consistent sidebar/header navigation
- Use cn() utility from lib/utils to merge Tailwind classes conditionally
- API routes: use `router.use(authMiddleware)` for protected routes, cast params with `as string`

---

## 2026-01-16 12:01 - US-014
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Implemented: Clients CRUD backend endpoints with pagination
- Files changed:
  - apps/api/src/routes/clients.ts (new - full CRUD for clients with auth and pagination)
  - apps/api/src/index.ts (registered clients routes)
- **Learnings for future iterations:**
  - Pagination: use skip/take with page/limit query params, return total and totalPages
  - Client model fields: name (required), email, phone, address, notes (all optional)
  - All endpoints tested: GET list, GET/:id, POST, PUT/:id, DELETE/:id
  - Response format: { client } for single, { clients, pagination } for list
  - Use conditional spread operator for partial updates: ...(field !== undefined && { field })
---

## 2026-01-16 11:57 - US-013
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Implemented: Categories CRUD backend endpoints
- Files changed:
  - apps/api/src/routes/categories.ts (new - full CRUD for categories with auth)
  - apps/api/src/index.ts (registered categories routes)
- **Learnings for future iterations:**
  - Route files apply authMiddleware to all routes via `router.use(authMiddleware)`
  - Use `req.params.id as string` to cast params to correct type for Prisma
  - Import CategoryType enum from @prisma/client for type validation
  - Categories have a `type` field with values PRODUCT or MATERIAL
  - findFirst with { id, userId } pattern checks both existence and ownership
---

## 2026-01-16 - US-012
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Implemented: App layout with sidebar navigation
- Files changed:
  - apps/web/src/components/Layout.tsx (new - main layout with sidebar and header)
  - apps/web/src/components/ui/sheet.tsx (new - Shadcn sheet component for mobile drawer)
  - apps/web/src/components/ui/separator.tsx (new - Shadcn separator component)
  - apps/web/src/components/ui/tooltip.tsx (new - Shadcn tooltip component)
  - apps/web/src/App.tsx (integrated Layout with protected routes)
  - apps/web/package.json (added @radix-ui/react-separator dependency)
- **Learnings for future iterations:**
  - Use Shadcn Sheet component for mobile sidebar drawer (slide in from left)
  - Layout uses fixed sidebar on desktop (md:w-64) with content offset (md:pl-64)
  - Mobile sidebar state managed with useState and Sheet open/onOpenChange
  - NavLink component uses useLocation() to determine active state
  - Active nav item uses bg-sidebar-accent and font-medium for visual distinction
  - Icons from lucide-react: LayoutDashboard, Users, Package, Boxes, FileText, Settings
---

## 2026-01-16 09:15 - US-011
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Implemented: Auth context, API client, and protected routes
- Files changed:
  - apps/web/src/lib/api.ts (new - API client with automatic token injection)
  - apps/web/src/contexts/AuthContext.tsx (new - auth state management with user, login, logout, register)
  - apps/web/src/components/ProtectedRoute.tsx (new - redirects to /login if not authenticated)
  - apps/web/src/App.tsx (integrated AuthProvider and ProtectedRoute)
  - apps/web/src/pages/LoginPage.tsx (updated to use AuthContext)
  - apps/web/src/pages/RegisterPage.tsx (updated to use AuthContext)
- **Learnings for future iterations:**
  - API client auto-injects Bearer token from localStorage for all requests
  - AuthContext checks token validity on mount by calling /auth/me endpoint
  - ProtectedRoute shows loading spinner while auth state is being determined
  - LoginPage preserves original URL via location.state.from for redirect after login
  - Use ApiError class for typed error handling in catch blocks
---

## 2026-01-16 08:45 - US-010
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Implemented: Login and registration pages with form validation
- Files changed:
  - apps/web/src/pages/LoginPage.tsx (new - login form with email/password)
  - apps/web/src/pages/RegisterPage.tsx (new - registration form with name/email/password/businessName)
  - apps/web/src/App.tsx (added /login and /register routes)
  - .claude/ralph/prd.json (marked US-005 through US-010 as passes: true)
- **Learnings for future iterations:**
  - Shadcn form components use react-hook-form Controller pattern via FormField
  - Use zodResolver from @hookform/resolvers for form schema validation
  - API returns { user, token } on successful auth
  - Store token in localStorage and redirect to / on success
  - Login page can display server errors via useState error state
---

## 2026-01-16 03:38 - US-004
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Implemented: Prisma ORM with complete database schema
- Files changed:
  - apps/api/package.json (added Prisma dependencies and db scripts)
  - apps/api/prisma/schema.prisma (complete schema with all models)
  - apps/api/prisma.config.ts (Prisma 7 config)
  - apps/api/.env (DATABASE_URL)
  - apps/api/.env.example (template for DATABASE_URL)
  - apps/api/.gitignore (exclude .env and generated Prisma)
- **Learnings for future iterations:**
  - Prisma 7 moved datasource URL from schema.prisma to prisma.config.ts
  - Docker Desktop on macOS can be unstable - be prepared for long image pulls
  - `prisma generate` works without database, `prisma migrate dev` requires running DB
  - Schema includes: User, Client, Category, Product, ProductMaterial, Material, Quote, QuoteItem
  - Enums: CategoryType (PRODUCT, MATERIAL), QuoteStatus (DRAFT, SENT, APPROVED, REJECTED, COMPLETED)
---
