# Ralph Progress Log - Artisan App
# Branch: ralph/artisan-management-app
# Started: 2026-01-16
# =========================================

## Codebase Patterns
- Package naming: @artisan/api, @artisan/web, @artisan/shared
- Root dev script uses concurrently to run api and web together
- TypeScript is used across all packages
- API runs on port 3001, Web runs on port 5173
- PostgreSQL runs on port 5433 (Docker) to avoid local PostgreSQL conflicts
- Prisma 7: Use `env("DATABASE_URL")` in prisma.config.ts, NOT `process.env` or schema.prisma url
- Prisma 7 Runtime: MUST use @prisma/adapter-pg with PrismaPg adapter for PrismaClient initialization
- TailwindCSS v4 uses CSS-based config (no tailwind.config.js), import via `@import "tailwindcss"` in CSS
- Shadcn/ui: Uses @/* path alias, components at src/components/ui/, utils at src/lib/utils.ts
- Auth: JWT_SECRET from env or default, bcrypt with 10 salt rounds, 7d token expiry
---

## 2026-01-16 - US-001
- What was implemented: Monorepo structure with npm workspaces
- Files changed:
  - package.json (root with workspaces config)
  - apps/api/package.json, tsconfig.json, src/index.ts
  - apps/web/package.json, tsconfig.json, src/index.ts
  - packages/shared/package.json, tsconfig.json, src/index.ts
  - .gitignore
- **Learnings for future iterations:**
  - Workspace packages reference each other via "*" in dependencies (e.g., "@artisan/shared": "*")
  - API package needs @types/node for console.log to typecheck
  - Root typecheck runs all workspace typechecks with `npm run typecheck --workspaces --if-present`
---

## 2026-01-16 - US-002
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented: Docker Compose configuration for PostgreSQL 15
- Files changed:
  - docker-compose.yml (new file at root)
- **Learnings for future iterations:**
  - Docker Compose uses named volume `postgres_data` for data persistence
  - Database credentials: artisan_db / artisan / artisan123
  - Includes healthcheck for reliable startup detection
  - Container name: artisan_postgres
---

## 2026-01-16 - US-003
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented: Express server with TypeScript and hot reload
- Files changed:
  - apps/api/package.json (added express, cors, ts-node-dev dependencies)
  - apps/api/src/index.ts (Express server with CORS and health endpoint)
- **Learnings for future iterations:**
  - Express 5.x is the current version (installed 5.2.1)
  - ts-node-dev with --respawn --transpile-only provides fast hot reload
  - CORS configured to allow requests from localhost:5173 (frontend)
  - Health check endpoint at GET /api/health returns { status: 'ok' }
  - Use underscore prefix for unused params (_req) to avoid TypeScript errors
---

## 2026-01-16 - US-004
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented: Prisma ORM with complete database schema and migrations
- Files changed:
  - apps/api/prisma/schema.prisma (complete schema with all models and relations)
  - apps/api/prisma.config.ts (fixed to use env() helper for DATABASE_URL)
  - apps/api/prisma/migrations/20260116111156_init/migration.sql (initial migration)
  - apps/api/.env.example (updated with port 5433 documentation)
  - docker-compose.yml (changed port to 5433 to avoid local PostgreSQL conflict)
- **Learnings for future iterations:**
  - Prisma 7 requires prisma.config.ts for database URL configuration
  - Use `env("DATABASE_URL")` from `prisma/config` instead of `process.env`
  - The `url` property is no longer supported in schema.prisma datasource block
  - Docker port 5433 is used externally to avoid conflicts with local PostgreSQL on port 5432
  - Run `npm run db:generate` then `npm run db:migrate -- --name init` to create migrations
  - Generated Prisma client goes to node_modules/@prisma/client
---

## 2026-01-16 - US-005
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented: Frontend with Vite, React 18, and TypeScript
- Files changed:
  - apps/web/package.json (replaced placeholder with Vite/React config)
  - apps/web/tsconfig.json (configured for React/Vite bundler mode)
  - apps/web/vite.config.ts (Vite config with React plugin, port 5173)
  - apps/web/index.html (Vite entry HTML)
  - apps/web/src/main.tsx (React root with StrictMode)
  - apps/web/src/App.tsx (BrowserRouter with basic Dashboard route)
  - apps/web/src/index.css (basic styling)
  - apps/web/src/vite-env.d.ts (Vite type definitions)
  - apps/web/public/vite.svg (favicon)
  - .gitignore (added *.tsbuildinfo)
- **Learnings for future iterations:**
  - Vite 6.x is the current version for React projects
  - React Router v6 uses BrowserRouter, Routes, and Route components
  - tsconfig uses `"jsx": "react-jsx"` for React 18
  - Vite config uses `@vitejs/plugin-react` for React support
  - Frontend dev server runs on port 5173 by default (configured in vite.config.ts)
  - Use `tsc -b --noEmit` for typecheck in Vite projects (uses project references)
---

## 2026-01-16 - US-006
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented: TailwindCSS v4 and Shadcn/ui configuration
- Files changed:
  - apps/web/package.json (added tailwindcss, @tailwindcss/vite, and shadcn dependencies)
  - apps/web/vite.config.ts (added tailwindcss plugin and @/* path alias)
  - apps/web/tsconfig.json (added baseUrl and paths for @/* alias)
  - apps/web/src/index.css (TailwindCSS v4 directives and CSS variables for themes)
  - apps/web/components.json (Shadcn/ui configuration)
  - apps/web/src/lib/utils.ts (cn utility for class merging)
  - apps/web/src/components/ui/button.tsx (Shadcn Button component)
  - apps/web/src/components/ui/input.tsx (Shadcn Input component)
  - apps/web/src/components/ui/card.tsx (Shadcn Card component)
  - apps/web/src/components/ui/dialog.tsx (Shadcn Dialog component)
  - apps/web/src/components/ui/table.tsx (Shadcn Table component)
  - apps/web/src/components/ui/select.tsx (Shadcn Select component)
  - apps/web/src/components/ui/form.tsx (Shadcn Form component)
  - apps/web/src/components/ui/label.tsx (Shadcn Label component)
  - apps/web/src/App.tsx (updated with sample Shadcn components for verification)
- **Learnings for future iterations:**
  - TailwindCSS v4 is CSS-first configuration (no tailwind.config.js needed)
  - Use `@import "tailwindcss"` instead of `@tailwind base/components/utilities` directives
  - Shadcn/ui requires path alias (@/*) configured in both tsconfig.json and vite.config.ts
  - Use `npx shadcn@latest init -d` for default configuration
  - Add components with `npx shadcn@latest add button input card dialog table select form -y`
  - Theme variables are defined in CSS using oklch color space (CSS Color Level 4)
  - Light/dark theme support via CSS custom properties and `.dark` class
---

## 2026-01-16 - US-007
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented: User registration endpoint with validation and JWT
- Files changed:
  - apps/api/package.json (added bcrypt, jsonwebtoken, @prisma/adapter-pg dependencies)
  - apps/api/src/index.ts (added auth routes)
  - apps/api/src/routes/auth.ts (POST /api/auth/register endpoint)
  - apps/api/src/lib/prisma.ts (centralized Prisma client with PG adapter)
- **Learnings for future iterations:**
  - Prisma 7 requires @prisma/adapter-pg with PrismaPg for runtime database connections
  - PrismaClient must be initialized with: `new PrismaClient({ adapter: new PrismaPg({ connectionString }) })`
  - Import dotenv/config at the top of lib/prisma.ts to load environment variables
  - bcrypt.hash() with 10 salt rounds for password hashing
  - jwt.sign() with { expiresIn: '7d' } for 7-day token expiry
  - Use destructuring to exclude password: `const { password: _, ...userWithoutPassword } = user`
  - Email validation regex: `/^[^\s@]+@[^\s@]+\.[^\s@]+$/`
---

